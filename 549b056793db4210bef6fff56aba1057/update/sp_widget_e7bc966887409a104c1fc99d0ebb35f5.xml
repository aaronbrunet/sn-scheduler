<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope,spUtil,$timeout) {
  /* widget controller */
  var c = this;
  	$scope.userDateFormat = g_user_date_format.toUpperCase();


	$scope.generateDrafts = function(_count){
		$scope.server.get({
            action: "generateDrafts",
            count: _count
        }).then(function(response) {
			$scope.data = response.data;
			//$scope.data.count = response.data.count;
			console.log('done updating server');
        });
	};
	var initDate = new moment(new Date($scope.data.latest_rotation.date)).format($scope.userDateFormat);
	$scope.data.selectedDate = initDate;
	
	$scope.datePicker = {label: 'Schedule',
		name: 'draft_rotation_schedule',
		value: $scope.data.selectedDate
	};
	

	$scope.customDate = function(e){
		console.log(e);
		//$scope.data.selectedDate = $event;
	};
};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>On Call Schedule - Draft Rotations</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	//var localInput = input; 
	var ocu = new x_snc_on_call_sc_0.OnCallUtils();
	var constants = ocu.getConstants();
	data.draft_rotations = [];
	data.count = 1;
	data.generated = false;

	var latest = new GlideRecord(constants.TABLE_ROTATIONS);
	latest.orderByDesc('to');
	latest.setLimit(1);
	latest.query();
	if(latest._next()){
		data.latest_rotation = {display:latest.getValue('to'),date: latest.getValue('to')+ "T00:00:00"};
		console.log('Server Date: '+ data.latest_rotation);
	}
	

	if(input && input.action == 'generateDrafts'){
		data.generated = true;
		data.count = input.count;
		let draft_rotations = ocu.buildDraftRotations(new GlideDateTime(),input.count);
		data.draft_rotations = draft_rotations;
	} 
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>aaron.brunet</sys_created_by>
        <sys_created_on>2024-08-13 01:20:37</sys_created_on>
        <sys_id>e7bc966887409a104c1fc99d0ebb35f5</sys_id>
        <sys_mod_count>130</sys_mod_count>
        <sys_name>On Call Schedule - Draft Rotations</sys_name>
        <sys_package display_value="On-Call Schedule" source="x_snc_on_call_sc_0">549b056793db4210bef6fff56aba1057</sys_package>
        <sys_policy/>
        <sys_scope display_value="On-Call Schedule">549b056793db4210bef6fff56aba1057</sys_scope>
        <sys_update_name>sp_widget_e7bc966887409a104c1fc99d0ebb35f5</sys_update_name>
        <sys_updated_by>aaron.brunet</sys_updated_by>
        <sys_updated_on>2024-08-22 20:02:23</sys_updated_on>
        <template><![CDATA[<div>
  <h3>Current latest rotation: {{data.latest_rotation.display}}</h3>
  <sp-date-picker id="datePickerField" field="datePicker" ng-model="data.selectedDate" sn-change="customDate()" sn-include-time="false"></sp-date-picker>
  <label for="input_count">
    How many weeks do you want to generate rotations for?
  	<input id="input_count" ng-model="data.count" min=1 max=12>  
    <button ng-click="generateDrafts(data.count)">Generate draft rotations</button>
  </label>
  <div ng-repeat="rotation in data.draft_rotations" ng-if="data.generated">
    <h4>{{rotation.name}}</h4>
  </div>	

</div>


]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>e7bc966887409a104c1fc99d0ebb35f5</id>
        <sys_created_by>aaron.brunet</sys_created_by>
        <sys_created_on>2024-08-13 01:24:05</sys_created_on>
        <sys_id>1a8d56a887409a104c1fc99d0ebb35fb</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>aaron.brunet</sys_updated_by>
        <sys_updated_on>2024-08-13 01:24:05</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
